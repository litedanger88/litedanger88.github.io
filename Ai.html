<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Premium AI Chat Assistant</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <!-- Highlight.js for syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
  <!-- Font Awesome for social media icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif}
    body{background:linear-gradient(135deg,#1a1f36,#3a1c71,#d76d77,#ffaf7b);background-size:300% 300%;animation:gradientShift 12s ease infinite;height:100vh;display:flex;flex-direction:column;overflow:hidden}
    @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .container{max-width:1000px;margin:20px auto;padding:20px;flex:1;display:flex;flex-direction:column;height:calc(100vh - 40px)}
    .chat-container{background:rgba(255,255,255,0.12);border-radius:24px;box-shadow:0 15px 40px rgba(0,0,0,0.25);flex:1;display:flex;flex-direction:column;overflow:hidden;backdrop-filter:blur(18px)}
    .chat-header{background:rgba(255,255,255,0.08);color:#fff;padding:18px 24px;font-size:1.4em;font-weight:600;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,0.15)}
    .chat-header .developer-btn{background:linear-gradient(135deg,#5a5fe0,#764ba2);color:white;padding:8px 15px;border:none;border-radius:12px;cursor:pointer;font-size:0.9em;font-weight:500;transition:all .18s ease;text-decoration:none;}
    .chat-header .developer-btn:hover{transform:translateY(-2px) scale(1.02);box-shadow:0 4px 10px rgba(0,0,0,0.2);}

    .chat-messages{flex:1;overflow-y:auto;padding:24px;background:rgba(255,255,255,0.05)}

    .message{margin-bottom:16px;padding:14px 20px;border-radius:18px;max-width:80%;animation:fadeIn .3s ease-in-out;line-height:1.6;font-size:15px;word-wrap:break-word;white-space:pre-wrap;box-shadow:0 4px 14px rgba(0,0,0,0.1)}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .user-message{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;margin-left:auto;border-bottom-right-radius:6px}
    .ai-message{background:rgba(255,255,255,0.95);color:#111;border-bottom-left-radius:6px}
    .file-message{background:rgba(255,255,255,0.95);color:#000;font-style:italic;border-left:4px solid #764ba2}

    .input-container{padding:18px;background:rgba(255,255,255,0.1);display:flex;gap:12px;border-top:1px solid rgba(255,255,255,0.15);align-items:center}
    #user-input{flex:1;padding:14px 16px;border:none;border-radius:12px;font-size:15px;outline:none;background:rgba(255,255,255,0.2);color:#fff}
    #user-input::placeholder{color:rgba(255,255,255,0.7)}
    .send-btn,.upload-btn{padding:10px 14px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:12px;cursor:pointer;font-size:15px;font-weight:500;transition:all .18s ease}
    .send-btn:hover,.upload-btn:hover{transform:translateY(-2px) scale(1.02)}

    .typing-indicator{display:none;padding:12px 18px;background:rgba(255,255,255,0.85);border-radius:18px;margin-bottom:16px}

    /* preview inside input */
    .pending-preview{display:none;align-items:center;gap:8px;background:rgba(255,255,255,0.06);padding:6px;border-radius:8px}
    .pending-preview img{width:56px;height:56px;object-fit:cover;border-radius:8px;display:block}
    .pending-preview .meta{color:#fff;font-size:13px}
    .pending-preview .remove-btn{background:transparent;border:1px solid rgba(255,255,255,0.18);color:#fff;padding:6px 8px;border-radius:8px;cursor:pointer}

    /* code block */
    .code-block{background:#0f1720;color:#e5e7eb;padding:12px;border-radius:8px;margin:10px 0;font-family:'Consolas','Monaco',monospace;position:relative;overflow:auto}
    .copy-btn{position:absolute;top:8px;right:8px;background:#667eea;color:#fff;border:none;padding:6px 10px;border-radius:6px;font-size:12px;cursor:pointer}
    .copy-btn:hover{background:#5a5fe0}

    .preview-img{max-width:240px;border-radius:10px;margin-top:8px;display:block;cursor:pointer;border:1px solid rgba(0,0,0,0.06)}

    




.footer {
 max-width: 1000px;
  margin: 20px auto;
  bottom: 0;
  left: 0;
  width: 100%;
  padding: 10px 0;
  text-align: center;
  background: linear-gradient(135deg,#f97316,#ea580c,#c2410c);
  color: #fff;
}
  </style>
</head>
<body>
  <div class="container">
    <div class="chat-container">
      <div class="chat-header">
        <div>AI Assistant</div>
        <a href="https://github.com/your-developer-profile" target="_blank" class="developer-btn">Developer</a>
      </div>
      <div class="chat-messages" id="chat-messages">
        <div class="message ai-message">Hello! Upload an image, write your note, or paste code (use ```code``` for blocks).</div>
      </div>

      <div class="typing-indicator" id="typing-indicator"><span>‚óè</span> <span>‚óè</span> <span>‚óè</span></div>

      <div class="input-container">
        <div class="pending-preview" id="pending-preview" style="display:none">
          <img id="preview-thumb" src="" alt="preview">
          <div class="meta" id="preview-meta"></div>
          <button class="remove-btn" id="remove-preview">Remove</button>
        </div>

        <input type="file" id="file-input" accept="image/*" style="display:none" onchange="handleFile(event)">
        <button class="upload-btn" onclick="document.getElementById('file-input').click()">üìé</button>

        <input type="text" id="user-input" placeholder="Type your message or paste code..." />
        <button class="send-btn" onclick="sendMessage()">Send</button>
      </div>

      <footer class="footer">
  ¬© 2025 <span>Public CSC</span> | All Rights Reserved
  <div class="socials">
    <a href=""><i class="fab fa-instagram" style="color:#E4405F;"></i></a>
    <a href="#"><i class="fab fa-telegram" style="color:#0088cc;"></i></a>
    <a href="#"><i class="fab fa-whatsapp" style="color:#25D366;"></i></a>
    <a href="#"><i class="fab fa-facebook" style="color:#1877F2;"></i></a>
  </div>
</footer>
  <!-- Highlight.js -->  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>  
  <script>
    // Initialize highlight.js (auto-detection will work, but we call manually after adding code)
    // hljs.configure({}); // optional config

    const API_KEY = "AIzaSyAmUCkN13PKrp69Xgcj1-x65NYpZqg0VmQ";  // Replace with your key
    const MODEL = "models/gemini-2.5-flash";  // Or whichever model you want
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/${MODEL}:generateContent`;

    const messagesDiv = document.getElementById('chat-messages');
    const typingIndicator = document.getElementById('typing-indicator');
    const userInput = document.getElementById('user-input');
    const fileInput = document.getElementById('file-input');
    const pendingPreview = document.getElementById('pending-preview');
    const previewThumb = document.getElementById('preview-thumb');
    const previewMeta = document.getElementById('preview-meta');
    const removePreviewBtn = document.getElementById('remove-preview');

    let uploadedImage = null; // { name, type, data, preview }

    function escapeHtml(str){
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function addMessage(text, sender, isFile = false, previewImg = null, filename = ''){
      const msg = document.createElement('div');
      msg.className = `message ${isFile ? 'file-message' : sender + '-message'}`;

      // detect triple-backtick code blocks: ```lang\ncode``` and also raw html/php heuristics
      const codeBlockRegex = /```(\w+)?\n?([\s\S]*?)```/g;
      let processed = false;
      const replaced = text.replace(codeBlockRegex, (match, lang, code) => {
        processed = true;
        const langClass = lang ? `language-${lang}` : '';
        return `<div class="code-block"><button class="copy-btn">Copy</button><pre><code class="${langClass}">${escapeHtml(code)}</code></pre></div>`;});

      if(processed){
        msg.innerHTML = replaced;
      } else if(!processed && (text.trim().startsWith('<') || text.includes('<?php'))){
        // heuristic: raw HTML/PHP-like content -> show as code
        processed = true;
        msg.innerHTML = `<div class="code-block"><button class="copy-btn">Copy</button><pre><code class="language-html">${escapeHtml(text)}</code></pre></div>`;
      } else {
        // normal text
        msg.textContent = text;
      }

      // attach preview image if provided
      if(previewImg){
        const img = document.createElement('img');
        img.src = previewImg;
        img.className = 'preview-img';
        img.alt = filename || 'image';
        // open full image on click
        img.addEventListener('click', ()=>{
          window.open(previewImg, '_blank');
        });
        msg.appendChild(img);
      }

      messagesDiv.appendChild(msg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      // After adding, highlight any code blocks and attach copy handlers
      const codeBlocks = msg.querySelectorAll('pre code');
      codeBlocks.forEach(codeEl => {
        try{ hljs.highlightElement(codeEl); } catch(e){ /* highlight may fail for unknown lang */ }
        const btn = codeEl.closest('.code-block')?.querySelector('.copy-btn');
        if(btn){
          // ensure only one listener
          btn.removeEventListener('click', btn._copyHandler);
          btn._copyHandler = () => {
            const codeText = codeEl.innerText;
            navigator.clipboard.writeText(codeText).then(()=>{
              btn.textContent = 'Copied!';
              setTimeout(()=>btn.textContent='Copy',2000);
            }).catch(()=>{
              btn.textContent = 'Copy';
              alert('Copy failed. Make sure you are on a secure (https) site or localhost.');
            });
          };
          btn.addEventListener('click', btn._copyHandler);
        }
      });
    }

    async function sendMessage(){
      const text = userInput.value.trim();
      if(!text && !uploadedImage) return;

      if(text) addMessage(text, 'user');
      if(uploadedImage) addMessage(`üñºÔ∏è Image attached: ${uploadedImage.name}`, 'user', true, uploadedImage.preview, uploadedImage.name);

      typingIndicator.style.display = 'block';
      userInput.value = '';
      hidePendingPreview();

      // build payload parts
      const parts = [];
      if(text) parts.push({ text });
      if(uploadedImage) parts.push({ inline_data: { mime_type: uploadedImage.type, data: uploadedImage.data } });

      const payload = { contents: [{ role: 'user', parts }] };

      try{
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'x-goog-api-key': API_KEY },
          body: JSON.stringify(payload)
        });

        const data = await response.json();
        typingIndicator.style.display = 'none';
        uploadedImage = null;

        // Enhanced error handling for AI response
        if(data.candidates?.[0]?.content?.parts?.[0]?.text){
          const aiText = data.candidates[0].content.parts[0].text;
          addMessage(aiText, 'ai');
        } else {
          console.error('Unexpected AI response structure:', data);
          addMessage('‚ö†Ô∏è Could not parse AI response or no response from AI.', 'ai');
        }
      }catch(err){
        console.error('API error', err);
        typingIndicator.style.display = 'none';
        uploadedImage = null;
        addMessage('‚ùå Error connecting to AI', 'ai');
      }
    }

    function handleFile(event){
      const file = event.target.files && event.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onloadend = ()=>{
        const base64 = reader.result.split(',')[1];
        uploadedImage = { name: file.name, type: file.type, data: base64, preview: reader.result };
        // show pending preview
        previewThumb.src = uploadedImage.preview;
        previewMeta.textContent = uploadedImage.name;
        pendingPreview.style.display = 'flex';
      };
      reader.readAsDataURL(file);
    }

    function hidePendingPreview(){
      pendingPreview.style.display = 'none';
      previewThumb.src = '';
      previewMeta.textContent = '';
    }

    removePreviewBtn.addEventListener('click', ()=>{
      uploadedImage = null;
      hidePendingPreview();
      fileInput.value = ''; // Clear the file input as well
    });

    userInput.addEventListener('keypress', (e)=>{ if(e.key === 'Enter') sendMessage(); });

    // helpful: expose addMessage to window for testing
    window.addMessage = addMessage;

  </script>
</body>
</html>